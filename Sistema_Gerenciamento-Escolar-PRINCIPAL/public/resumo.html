<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Resumo de Frequência Diário - EduGest</title>
    <link rel="stylesheet" href="css/style.css"> 
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    
    <style>
        .resumo-page-container {
            max-width: 900px;
            margin: 50px auto;
            padding: 30px;
            background-color: #ffffff;
            border-radius: 15px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.1);
        }
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-top: 20px;
        }
        /* Garantindo o visual dos cards do seu style.css */
        .card h4 { margin: 0; font-size: 1.1em; color: #6a737b; }
        .card h2 { margin-top: 5px; }
        .error-message { color: #f44336; font-weight: 600; margin-top: 15px; }

        @media (max-width: 768px) {
            .stats-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>

    <div class="resumo-page-container">
        <div style="display: flex; align-items: center; border-bottom: 2px solid #eee; padding-bottom: 15px; margin-bottom: 20px;">
            <i class="fas fa-chart-pie" style="font-size: 2em; color: #3f51b5; margin-right: 15px;"></i>
            <h1 style="color: #3f51b5; margin: 0;">Resumo da Frequência Diária</h1>
        </div>
        
        <p style="color: #6a737b;">Estatísticas de presença registradas para o dia de hoje.</p>
        <div id="loading-status" style="font-style: italic; color: #999;">Carregando dados...</div>
        
        <div class="stats-grid">
            <div class="card" style="background: #e8f5e9; border-left: 5px solid #4CAF50;">
                <h4>Presentes</h4>
                <h2 id="painel-presentes" style="color: #2e7d32; font-size: 2.5em;">...</h2>
            </div>
            
            <div class="card" style="background: #ffebee; border-left: 5px solid #f44336;">
                <h4>Ausentes</h4>
                <h2 id="painel-ausentes" style="color: #c62828; font-size: 2.5em;">...</h2>
            </div>
            
            <div class="card" style="background: #fff3e0; border-left: 5px solid #ff9800;">
                <h4>Atrasados</h4>
                <h2 id="painel-atrasados" style="color: #ef6c00; font-size: 2.5em;">...</h2>
            </div>
        </div>
    </div>

    <script>
        async function carregarResumoDedicatorio() {
            const statusElement = document.getElementById("loading-status");
            // Adiciona um spinner para indicar que a atualização está ocorrendo
            statusElement.innerHTML = `<i class="fas fa-sync fa-spin"></i> Atualizando dados...`; 

            try {
                // Chamada à rota do seu Back-end que já está funcionando
                const resposta = await fetch("http://localhost:3000/api/presencas/resumo");
                
                if (!resposta.ok) {
                    throw new Error(`Erro HTTP: ${resposta.status}. Servidor respondeu, mas com falha.`);
                }

                const dados = await resposta.json();

                // Preencher as porcentagens
                document.getElementById("painel-presentes").innerText = dados.presentes + "%";
                document.getElementById("painel-ausentes").innerText = dados.ausentes + "%";
                document.getElementById("painel-atrasados").innerText = dados.atrasados + "%";
                
                // Adiciona a hora da última atualização para feedback visual
                const agora = new Date().toLocaleTimeString('pt-BR');
                statusElement.innerHTML = `<i class="fas fa-check-circle" style="color: #4CAF50;"></i> Dados carregados com sucesso! (Total de registros: ${dados.total}) - Última atualização: ${agora}`;

            } catch (erro) {
                console.error("Erro ao buscar dados do resumo:", erro);
                document.getElementById("painel-presentes").innerText = "-";
                document.getElementById("painel-ausentes").innerText = "-";
                document.getElementById("painel-atrasados").innerText = "-";
                
                statusElement.innerHTML = `<span class="error-message"><i class="fas fa-exclamation-triangle"></i> ERRO: Não foi possível carregar os dados. Verifique se o servidor Node.js está ligado.</span>`;
            }
        }

        // 1. Executa a função ao carregar a página (primeira carga)
        carregarResumoDedicatorio();

        // 2. Configura a atualização automática (Polling) a cada 10 segundos
        // O valor 10000 é 10 segundos em milissegundos.
        setInterval(carregarResumoDedicatorio, 10000); 
    </script>
</body>
</html>